#include <float.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <h3/h3api.h>
#include <split/bbox3.h>
#include <split/parse.h>
#include <split/vect3.h>
#include "print.h"

const char Polygon[] = "POLYGON((-179.79478922589513 -12.652177592020415,-179.62436315790896 -12.492218624716745,-179.4146090006971 -12.544878094593585,-179.24409637944018 -12.38436158253902,-179.03334881551962 -12.436646343041064,-178.99278559059962 -12.650219750370336,-178.78071932047578 -12.702895922322433,-178.6095555907641 -12.541228397007709,-178.3965132384034 -12.593519654812512,-178.2253037187871 -12.431307786262519,-178.0113000723539 -12.483212112324521,-177.8400605822648 -12.320465912291187,-177.6251108163989 -12.371981474869951,-177.5810295563392 -12.58699576230699,-177.36476691215228 -12.638868839402312,-177.192968109725 -12.474977628849995,-176.97577972904406 -12.526451963309862,-176.80399397481463 -12.362041927994023,-176.58589619732234 -12.413116044813883,-176.53918107361037 -12.629337277282268,-176.31977597096275 -12.680741819620204,-176.14750109419114 -12.515191095356458,-175.92720928067007 -12.566185590852223,-175.75499209570248 -12.400133215388111,-175.5338310619242 -12.450716578863647,-175.36168839830097 -12.284174233816143,-175.139675993936 -12.33434558933202,-175.0893596939782 -12.551771317789987,-174.86605584618908 -12.602236097723011,-174.6935273122727 -12.434566899041224,-174.46939786324614 -12.484610269776702,-174.29699035451682 -12.316470677378614,-174.07205426433683 -12.366092194217503,-174.0190466270046 -12.584545802489608,-173.79283231655546 -12.634431238059069,-173.62011746704815 -12.465174900368135,-173.39312457817422 -12.514629385477358,-173.2205785560117 -12.344923957994094,-172.99282712161715 -12.393947509542333,-172.93711018610006 -12.613347700082498,-172.70809715940763 -12.66260470090274,-172.5353256264755 -12.491795200855167,-172.3055843805861 -12.540612544639206,-172.13303060961408 -12.369376999294094,-171.90258220218553 -12.417755193115292,-171.84414375715727 -12.63801710411192,-171.61245385788175 -12.686597419465617,-171.4397594640347 -12.514273127783616,-171.20739494397537 -12.562406011706244,-171.0349681955014 -12.38968046046018,-170.80195107841945 -12.437366936469445,-170.74078495750797 -12.658402362665877,-170.50654996530403 -12.706258890015574,-170.33407026040655 -12.532462646437988,-170.09921735719522 -12.579864994930668,-169.92705592948542 -12.405694006641223,-169.99006913739086 -12.18480993489481,-169.81855212326977 -12.010969462395693,-169.8816059472542 -11.791022848302362,-170.1152646629388 -11.744824653597432,-170.17745032834233 -11.525733126035785,-170.00688554592648 -11.352934898996915,-170.0691146405919 -11.134802931436615,-169.89918142327457 -10.962377250011096,-169.9614517655805 -10.745218957049,-169.79214676278067 -10.573185157010991,-169.85445620827062 -10.357014206322255,-170.08518198273921 -10.312769242705444,-170.14664508012814 -10.09748623183405,-169.9782673757203 -9.926558663256447,-170.03977229377082 -9.712282169585546,-169.87201043712435 -9.54178516898468,-169.93355508032846 -9.328527652800599,-170.16198870419743 -9.285651192178866,-170.22270332537235 -9.073304175220501,-170.05585358009293 -8.903951963537796,-170.1166105401231 -8.69264095017733,-169.95036463042135 -8.523755553505396,-170.01116188140062 -8.313491803129482,-169.84551668068374 -8.145090232564108,-169.90635220876163 -7.935884556908268,-170.13198201982917 -7.894950301248764,-170.19200792160382 -7.686678791455977,-170.41653353729598 -7.645988121669846,-170.47575629993577 -7.438659839052237,-170.69917645154004 -7.398223234809016,-170.86390848255238 -7.564542051553546,-171.08674840929393 -7.523791394935506,-171.25173943649207 -7.689904244542943,-171.4739796585819 -7.648836942044621,-171.53071035498093 -7.442246582414087,-171.7518235238334 -7.401457075998802,-171.91671287320298 -7.566663239569054,-172.1371972907378 -7.525561513954707,-172.30230184885826 -7.690536277481628,-172.52213882282743 -7.649120104018685,-172.5763810021539 -7.443339869455369,-172.79507227506053 -7.402224518917754,-172.96000014853493 -7.566274265070634,-173.17801675997367 -7.524849186952609,-173.3431167878336 -7.688643330662649,-173.56044088289585 -7.646906652205121,-173.61220322009908 -7.44200603766723,-173.8283658799048 -7.40059243704956,-173.9932166823105 -7.563445266980387,-174.20866148184422 -7.52172504402223,-174.37364226900579 -7.684299327886214,-174.5883522324316 -7.642270954784459,-174.63764830215985 -7.438316590324927,-174.8511839632845 -7.396632716839211,-175.01584565554842 -7.558251392782633,-175.2286230409303 -7.516264568790916,-175.39337357144788 -7.677583032909175,-175.60537661802348 -7.635292062920091,-175.65222464574416 -7.43234757944563,-175.86304332639435 -7.390421643824967,-176.02740774103853 -7.550772164700786,-176.23743056334237 -7.508547468464658,-176.40184381735313 -7.668577399981062,-176.61105565682874 -7.626053065858946,-176.65547825101027 -7.424178984476953,-176.8634983850609 -7.382039286078631,-177.02746149945202 -7.5410908448024,-177.23465105337567 -7.498657044346921,-177.39862426605538 -7.657368926554411,-177.60496907211353 -7.614640449716286,-177.64699294132558 -7.41389409440271,-177.85214133349928 -7.371568882458708,-178.01560350077588 -7.529293806652378,-178.21988945935388 -7.486679570259925,-178.38332433738722 -7.644047015695286,-178.58673466221902 -7.601143467268368,-178.6263903209326 -7.401578900304746,-178.82860204942034 -7.359096242519919,-178.99146818761088 -7.515469920430457,-179.19278848567564 -7.472703685580155,-179.3555913819645 -7.628703354962858,-179.55600802097453 -7.585653525309438,-179.59332948770776 -7.387321504684172,-179.7925477587707 -7.344709164178899,-179.95472749914376 -7.499709957647222,-180 -7.489926585928823,-180 -12.600045682721134,-179.79478922589513 -12.652177592020415))";


int main() {
    WktParseResult result = wkt_parse(Polygon, strlen(Polygon));
    if (result.error) {
        printf(
            "(at %d) %s\n",
            (int) result.error_pos,
            wkt_parse_error_to_string(result.error));
        if (result.message)
            printf("%s\n", result.message);
        exit(EXIT_FAILURE);
    }
    LinkedGeoPolygon* polygon = result.object;

    Bbox3 bbox;
    bbox3_from_linked_loop(&bbox, polygon->first);

    printf("bbox: ");
    /* print_bbox3_polygon(&bbox); */
    print_bbox3(&bbox);
    print_nl();
    print_nl();

    const LinkedGeoLoop* loop = polygon->first;
    for (const LinkedLatLng* point = loop->first; point != NULL; point = point->next) {
        if (!bbox3_contains_latlng(&bbox, &point->vertex)) {
            printf("Outer shell point not in bbox: ");
            print_latlng(&point->vertex);
            print_nl();
            return EXIT_FAILURE;
        }
    }
}
